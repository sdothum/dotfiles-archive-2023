# sdothum - 2016 (c) wtfpl

# Make
# ══════════════════════════════════════════════════════════════════════════════

# ...................................................................... iosevka

usage() { 
  echo "usage: $(basename $0) iosevka [kindle | kobo | ebook | web] [family <name>]
                            [D-serifless | I-serifless | Q-detached | a-single | b-rounded | d-tailed | f-extended | p-eared | p-serifed | q-hook | at-tall | 0-split | paren-flat | book+regular]*
                            [-- <opions>*]"
  exit 1
}

# e.g. with optional glyph variants..
#        make_install iosevka kobo                                               # default kobo fonts
#        make_install iosevka kobo a-single f-extended I-serifless family aFont  # custom e-ink font
#        make_install iosevka I-serifless f-extended at-tall                     # custom desktop fonts
#        make_install iosevka -- I-serifless family forCoding                    # single custom font, see font/iosevka

MAKE_INSTALL=/tmp/iosevka:make_install
SRCDIR=$HOME/bin/functions/font
DEPOT=/net/depot
GLYPH=b-rounded

touch $MAKE_INSTALL
trap "rm -f $MAKE_INSTALL" EXIT
shift

glyph() { unset b d p; eval $1=$2; GLYPH=$2; }

while [ $1 ] ;do
  case $1 in
  D-serifless ) D=D-serifless ;;
  I-serifless ) I=I-serifless ;;                    # source code variant
  Q-detached  ) Q=Q-detached ;;
  a-single    ) a=a-single ;;
  b-rounded   ) glyph b b-rounded ;;                # unolexic
  d-tailed    ) glyph d d-tailed ;;                 # ebook variant
  f-extended  ) f=f-extended ;;                     # unolexic (homage to universal grotesk)
  p-eared     ) glyph p p-eared ;;
  p-serifed   ) glyph p p-serifed ;;
  q-hook      ) q=q-hook ;;                         # ebook variant
  at-tall     ) at=at-tall ;;                       # source code variant
  0-split     ) zero=0-split ;;
  paren-flat  ) paren=paren-flat ;;                 # source code variant
  book+regular) adjust=book+regular ;;
  source-only ) source_only=true ;;
  kindle      ) ereader=$1; adjust=book+regular ;;  # add regular/book weight blending (for small fonts on Kindle)
  kobo        ) ereader=$1; q=q-hook ;;
  family      ) [ $ereader ] && [ $2 ] && { family=$2; shift; } || usage ;;
  ebook       ) ebook=true ;;
  web         ) web=true ;;
  --          ) shift; . $HOME/bin/functions/font/iosevka $@; exit ;;
  *           ) usage ;;
  esac
  shift
done

# build font suite
ifno 'build iosevka font suite' && exit

update() {
  fonts='*-book *-bookitalic *-bold *-bolditalic'
  cd $HOME/.fonts/$2

  for i in $fonts ;do
    file=$i.ttf
    folder=$STOW/$ereader/fonts/$1
    mkdir -p $folder
    cp -v $file $folder/
  done
}

options() { echo $@ $D $I $Q $a $b $d $f $p $q $zero; }  # list

# family [options]*
e_ink() {
  name=$1
  shift
  iosevka dyslexic $ereader english $(options $@) $adjust family $name
  update $GLYPH $name
}

dfont() { iosevka expanded            $(options $@) q-hook $at $paren; }
wfont() { iosevka english I-serifless $(options $@) q-hook; }
efont() { iosevka english             $(options $@) q-hook $adjust; }

version() {
  ln -s $SRCDIR/iosevka.$1 $SRCDIR/iosevka || exit
  ln -s $DEPOT/Iosevka.$1  $DEPOT/Iosevka  || exit
}

[ -L $SRCDIR/iosevka ] && rm -f $SRCDIR/iosevka
[ -L $DEPOT/Iosevka ] && rm -f $DEPOT/Iosevka

if [ $family ] ;then
  version 10x
  # custom e-ink font (non-published)
  e_ink $family

elif [ $ereader ] ;then
  version 10x
  # e-ink fonts
  e_ink iMonolexic
  e_ink Monolexic   I-serifless
  e_ink iUnolexic   f-extended
  e_ink Unolexic    f-extended I-serifless
  e_ink ielementary a-single
  e_ink elementary  a-single   I-serifless

elif [ $ebook ] ;then
  version 10x
  # e-reader fonts
  efont ebook
  efont ebook    I-serifless
  efont ebook    quasi-proportional
  efont ebook    quasi-proportional I-serifless
  efont dyslexic quasi-proportional
  efont dyslexic quasi-proportional I-serifless

elif [ $web ] ;then
  version 10x
  # www fonts
  wfont heading  kobo webfont
  wfont dyslexic kobo webfont
  wfont dyslexic quasi-proportional space 1.25 kobo webfont

else
  version 15x
  # desktop fonts
  dfont
  dfont proof
  dfont menu
fi

# vim: set ft=sh: #
