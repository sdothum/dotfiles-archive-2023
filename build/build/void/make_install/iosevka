# sdothum - 2016 (c) wtfpl

# Make
# ══════════════════════════════════════════════════════════════════════════════

# ...................................................................... iosevka

usage() { echo "usage: $(basename $0) iosevka [kindle | kobo | I-serifless | b-rounded | d-tailed | p-eared | p-serifed | q-curly | at-tall | paren-flat | book+regular | source-only]* | [-- <opions>*]"; exit 1; }

# e.g. with optional glyph variants..
#        make_install iosevka kobo                                       # default kobo fonts
#        make_install iosevka I-serifless f-extended q-curly at-tall     # source code, web and e-reader fonts
#        make_install iosevka -- I-serifless family myfont               # single custom font, see font/iosevka

MAKE_INSTALL=/tmp/iosevka:make_install
SRCDIR=$HOME/bin/functions/font
DEPOT=/net/depot
GLYPH=b-rounded

touch $MAKE_INSTALL
trap "rm -f $MAKE_INSTALL" EXIT
shift

glyph() { unset b d p; eval $1=$2; GLYPH=$2; }

while [ $1 ] ;do
  case $1 in
  D-serifless ) D=D-serifless ;;
  I-serifless ) flavour=I-serifless ;;              # source code variant
  Q-detached  ) Q=Q-detached ;;
  b-rounded   ) glyph b b-rounded ;;                # unolexic
  d-tailed    ) glyph d d-tailed ;;                 # ebook variant
  f-extended  ) f=f-extended ;;                     # unolexic (homage to universal grotesk)
  p-eared     ) glyph p p-eared ;;
  p-serifed   ) glyph p p-serifed ;;
  q-curly     ) q=q-curly ;;                        # ebook variant
  at-tall     ) at=at-tall ;;                       # source code variant
  paren-flat  ) paren=paren-flat ;;                 # source code variant
  book+regular) adjust=book+regular ;;
  source-only ) source_only=true ;;
  kindle      ) ereader=$1; adjust=book+regular ;;  # add regular/book weight blending (for small fonts on Kindle)
  kobo        ) ereader=$1; q=q-curly ;;
  --          ) shift; . $HOME/bin/functions/font/iosevka $@; exit ;;
  *           ) usage ;;
  esac
  shift
done

# build font suite
ifno 'build iosevka font suite' && exit

update() {
  fonts='*-book *-bookitalic *-bold *-bolditalic'
  cd $HOME/.fonts/$2

  for i in $fonts ;do
    file=$i.ttf
    folder=$STOW/$ereader/fonts/$1
    mkdir -p $folder
    cp -v $file $folder/
  done
}

# family [options]*
e_ink() {
  family=$1
  shift
  iosevka dyslexic $ereader english $@ $b $D $d $p $Q $q $adjust family $family
  update $GLYPH $family
}

dfont() { iosevka expanded $flavour   $@ $b $d $f $p $Q q-curly $at $paren; }
wfont() { iosevka english I-serifless $@ $b $d $f $p $Q q-curly; }
efont() { iosevka english             $@ $b $d $f $p $Q q-curly $adjust; }

version() {
  ln -s $SRCDIR/iosevka.$1 $SRCDIR/iosevka || exit
  ln -s $DEPOT/Iosevka.$1  $DEPOT/Iosevka  || exit
}

[ -L $SRCDIR/iosevka ] && rm -f $SRCDIR/iosevka
[ -L $DEPOT/Iosevka ] && rm -f $DEPOT/Iosevka

if [ $ereader ] ;then
  version 10x
  # *Monolexic
  e_ink iMonolexic
  e_ink Monolexic I-serifless
  # *Unolexic
  e_ink iUnolexic f-extended
  e_ink Unolexic  f-extended I-serifless
  # *Duolexic
  # e_ink iDuolexic f-extended p-eared
  # e_ink Duolexic  f-extended p-eared I-serifless
else
  version 15x
  # desktop fonts
  dfont
  dfont proof
  dfont menu
  [ $source_only ] && exit

  # www fonts
  wfont heading  kobo webfont
  wfont dyslexic kobo webfont
  wfont dyslexic quasi-proportional space 1.25 kobo webfont

  # e-reader fonts
  efont ebook
  efont ebook    I-serifless
  efont ebook    quasi-proportional
  efont ebook    quasi-proportional I-serifless
  efont dyslexic quasi-proportional
  efont dyslexic quasi-proportional I-serifless
fi

# vim: set ft=sh: #
