#!/usr/bin/dash
# sdothum - 2016 (c) wtfpl

# Media
# ══════════════════════════════════════════════════════════════════════════════

# ..................................................... kobopatch override rules

# create kobopatch.yaml overrides: section
# configure $RULES (yes/no)
# run ./kobopatch.sh to generate out/KoboRoot.tgz

RULES=kobopatch.yaml

[ -e $RULES.original ] && { ifno "overwrite $RULES" && exit; } || original $RULES
[ -e src/nickel.yaml ] || { ditto dir "yaml files not found"; exit 1; }
dos2unix $RULES 2>/dev/null
sed -i '/^overrides:/,$d' $RULES  # prune overrides
cd src >/dev/null
RULES=../$RULES
echo "overrides:" >>$RULES

for i in *yaml ;do
  [ $i = $RULES ] && continue
  dos2unix $i 2>/dev/null
  echo "\n  src/$i:" >>$RULES
  perl -0777 -pe 's/([[:alpha:]].*)\n.*Enabled:(.*)/\1\2/g' $i | grep '^[[:alpha:]]' | sed 's/^/    /' >>$RULES
done

# vim: set ft=sh: #
